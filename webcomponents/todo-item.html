<html>
  <body>
    <script>
var TodoItemProto = Object.create(HTMLLIElement.prototype);

// `createdCallback` is called when the custom element is created. We can use
// it to set up events and build up the shadow DOM
TodoItemProto.createdCallback = function () {

  // Initialize shadow DOM
  this.shadow = this.createShadowRoot();

  var input = document.createElement('input');
  var label = document.createElement('label');

  var id = 'todo-1';

  input.setAttribute('type', 'checkbox');
  input.setAttribute('id', id);
  label.setAttribute('for', id);

  input.addEventListener('change', function (e) {
    if (input.checked) {
      this.setAttribute('completed', true);
      this.dispatchEvent(new CustomEvent('completed', {
        detail: {
          id: this.getAttribute('id').split('todo-').pop()
        }
      }));
    }
  }.bind(this));

  // Add the children to the shadow DOM
  this.shadow.appendChild(input);
  this.shadow.appendChild(label);
};

TodoItemProto.attributeChangedCallback = function (key) {
  var $ = this.shadow.querySelector;
  switch (key) {
    case 'id':
      this.id = this.getAttribute('id');
      break;

    case 'completed':
      if (this.getAttribute('completed') === 'true') {
        this.shadow.querySelector('input').setAttribute('disabled', 'disabled');
        this.shadow.querySelector('input').setAttribute('checked', 'checked');
      }
      break;

    case 'label':
      this.shadow.querySelector('label').textContent = this.getAttribute('label');
      break;
  }
};

document.registerElement('todo-item', {
  prototype: TodoItemProto
});

    </script>
  </body>
</html>

